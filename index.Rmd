---
title: "GEO 511 Final Project"
author: Brendan Kunz
subtitle: Housing Violations by Neighborhood 
---

# Introduction 

[~ 200 words]

Clearly stated background and questions / hypotheses / problems being addressed. Sets up the analysis in an interesting and compelling way.

For my project, I’ll be looking at 311 requests in Buffalo that allege code violations by landlords, stretching from 2008 to the beginning of 2020. This issue caught my interest because in a previous internship during my undergrad, I would canvass in mostly low income neighborhoods of Binghamton where I was able to see the negligence of slum lords in these areas. Within Binghamton, these poor living conditions for renters was mostly confined to a handful of neighborhoods so I’m wondering if I will be able to see something similar in Buffalo by looking at the 311 requests. Also I’m interested in looking at a number of demographics that might correspond with high housing violations such as the tendency for racial minorities to be confined largely to low-income, underdeveloped neighborhoods and also poverty rates. Going into this, it’s important to note that issues concerning housing are highly complex and no single factor is going to be able to explain this and the data provided doesn’t account for what percent of housing units are rentals and what the density of the neighborhoods are to begin with.


# Materials and methods

[~ 200 words]

Narrative: Clear narrative description of the data sources and methods. Includes data from at least two sources that were integrated / merged in R.

Code: The code associated with the project is well organized and easy to follow. Demonstrates mastery of R graphics and functions.


Data: The underlying data are publicly accessible via the web and downloaded/accessed within the Rmd script. If you want to use your own data, you must make it available on a website (e.g. Figshare) so that others are able to re-run your code.

You can do bullets like this:

* The first most important thing
* The second most important thing
* The third most important thing 

You can do numbers like this:

1. The first most important thing
2. The second most important thing
3. The third most important thing

See [http://rmarkdown.rstudio.com/](http://rmarkdown.rstudio.com/) for all the amazing things you can do.


Load any required packages in a code chunk (you may need to install some packages):

```{r Libraries, message=F, warning=F}
library(tibble)
library(rgdal)
library(sp)
library(sf)
library(GISTools)
library(RColorBrewer)
library(tbart)
library(viridis)
library(dplyr)
require(rgdal)
library(ggmap)
library(ggplot2)
library(raster)
library(tmap)
library(kableExtra)
knitr::opts_chunk$set(cache=TRUE)  # cache the results for quick compiling
```

## Download and clean all required data
```{r housing violation map prep}
#neighborhoods <- st_read(dsn = path.expand("violation_count2.shp"), layer = "violation_count2")
URL <- "https://raw.githubusercontent.com/geo511-2020/geo511-2020-project-btkunz/master/violation_count3.geojson"
neighborhoods <- st_read(dsn = URL)
neighborhood <- st_as_sf(neighborhoods,4326)
str(neighborhoods)
color_viol <- brewer.pal(5, "Blues")
color_viol <- colorRampPalette(color_viol)(35)
census_tracts <- cut(neighborhood$NUMPOINTS, 35)
color_viol <- color_viol[as.numeric(census_tracts)]

#neighborhoods <- st_read(dsn = path.expand("violation_count.shp"), layer = "violation_count")

```

```{r Housing Violations Map}
library(tmap)
library(ggmap)
#str(neighborhood)
 # ggplot(col = neighborhood$NUMPOINTS)+
 #     geom_sf(data = neighborhoods, aes(x=x,y=y, fill = color_viol))

#Expand bbox to accommodate for a title and legend
nbhd_bbox <- st_bbox(neighborhood)

print(nbhd_bbox)

xrange <- nbhd_bbox$xmax - nbhd_bbox$xmin
yrange <- nbhd_bbox$ymax - nbhd_bbox$ymin

nbhd_bbox[1] <- nbhd_bbox[1] - (0.3 * xrange) #learned how to efficiently adjust the bbox from stack overflow
nbhd_bbox[3] <- nbhd_bbox[3] + (0.3 * xrange)
nbhd_bbox[2] <- nbhd_bbox[2] - (0.2 * yrange)
nbhd_bbox[4] <- nbhd_bbox[4] + (0.2 * yrange)


 tm_shape(neighborhood, bbox = nbhd_bbox)+
    #tm_polygons(col = "NUMPOINTS", palette = blues9)+
    tm_fill("NUMPOINTS", title = "Housing\nViolations", palette = blues9, n = 9)+
    tm_borders()+               #helped by Collin
    tm_layout(title = "Housing Violations By Neighborhood", title.position = c("center","top"), 
              title.bg.color = "gray", title.bg.alpha = 0.5)
#ggplot(data = neighborhood)+ 
#geom_sf()
# plot(neighborhoods["NUMPOINTS"], col = color_viol, main = "Housing violation reports by neighborhood")
# legend("bottomright", title = "Housing Violations", legend = levels(cut(neighborhoods$NUMPOINTS, 5)), fill = color_viol) #ISSUE TO NOTE: it seems that the legend is uncooperative in matching the correct colors to the different values so whomever is peer reviewing this, do you have any suggestions?  
# plot1 <- ggplot(neighborhood["NUMPOINTS"],aes(x=x,y=y, col = color_viol))+
#   geom_polygon(aes(fill = color_viol))
# plot1
 
 
 #Check out geom_sf to plot polygons rather than using x and y
```




```{r}
URL2 <- "https://raw.githubusercontent.com/geo511-2020/geo511-2020-project-btkunz/master/Neighborhood_Statistics.geojson"
demographics <- st_read(dsn = URL2)
st_as_sf(demographics,4326)

#Edits to the bbox to accommodate for a title and legend
buff_bbox <- st_bbox(demographics)
print(buff_bbox)

xrange <- buff_bbox$xmax - buff_bbox$xmin
yrange <- buff_bbox$ymax - buff_bbox$ymin

buff_bbox[1] <- buff_bbox[1] - (0.25 * xrange) #learned how to efficiently adjust the bbox from stack overflow
buff_bbox[3] <- buff_bbox[3] + (0.25 * xrange)
buff_bbox[2] <- buff_bbox[2] - (0.2 * yrange)
buff_bbox[4] <- buff_bbox[4] + (0.2 * yrange)

tm_shape(demographics, bbox = buff_bbox)+
   tm_fill("Poverty.Ra", title = "Poverty Rate", palette = blues9, n = 9)+
   tm_borders()+
   tm_layout(title = "Poverty Rate By Neighborhood ", title.position = c("center","top"), title.bg.color = "gray", 
             title.bg.alpha = 0.5)

#color_scheme <- brewer.pal(5, "Blues")
#color_scheme <- colorRampPalette(color_scheme)(35)

#census_tract <- cut(demographics$Percent.Wh, 35) 
#color_scheme <- color_scheme[as.numeric(census_tract)]
#str(demographics$Percent.Wh)
#print(demographics$Percent.Wh)

#plot(demographics["Percent.Wh"], col = color_scheme)

```

Add any additional processing steps here.

# Results

[~200 words]

Tables and figures (maps and other graphics) are carefully planned to convey the results of your analysis. Intense exploration and evidence of many trials and failures. The author looked at the data in many different ways before coming to the final presentation of the data.

Show tables, plots, etc. and describe them.

```{r}
plot(demographics["Percent.Wh"], col = color_scheme, main = "Percent White by Neighborhood")
legend("bottomright", title = "Percent White", legend = levels(cut(demographics$Percent.Wh, 5)), fill = color_scheme)
     
```

  This map focuses on the issue of lingering segregation in Buffalo that many of us are already aware of, where North and South Buffalo are predominately White while the East side is predominately Black. As stated above, my initial thoughts were that violation reports would be largely concentrated in the East and West sides of Buffalo due to what I perceived to be a large number of rentals relative to the other areas of the city. 
```{r}
plot(neighborhoods["NUMPOINTS"], col = color_viol, main = "Housing violation reports by neighborhood")
legend("bottomright", title = "Housing Violations", legend = levels(cut(neighborhoods$NUMPOINTS, 5)), fill = color_viol) #ISSUE TO NOTE: it seems that the legend is uncooperative in matching the correct colors to the different values so whomever is peer reviewing this, do you have any suggestions?  
```

  This map focuses on the core of what I'm looking at: housing violation allegations filed through the 311 service. As it would appear, my initial thoughts are somewhat accurate where the largest number of housing violations are concentrated in the center of the east side. That being said, I didn't consider how there could be potential slumlord issues off of south campus as I don't have a lot of knowledge about University Heights relative to the rest of the city. Also it seems that housing violations seem to be fairly high in the northern center of North Buffalo which came as a bit of a surprise as I perceived most of North Buffalo to be wealthy single family homes with higher end apartments dotted on the major roads. When moving into the final draft it might be worth looking at how poverty is distributed throughout the city as that could give me a greater understanding of the situation. 

# Conclusions

[~200 words]

Clear summary adequately describing the results and putting them in context. Discussion of further questions and ways to continue investigation.

# References

All sources are cited in a consistent manner

https://www.jla-data.net/eng/adjusting-bounding-box-of-a-tmap-map/

